<div class="detail-container" *ngIf="order; else notFound">
  
  <div class="header">
    <button (click)="goBack()" class="back-btn">← Back to History</button>
    <div class="header-info">
      <h1>Order #{{ order.id }}</h1>
      <span class="badge" [ngClass]="order.status.toLowerCase()">
        {{ order.status }}
      </span>
    </div>
  </div>

  <div class="timeline-card">
    <h3>Order Progress</h3>
    <div class="timeline">
      <div class="step active">Ordered</div>
      
      <div class="step" [class.active]="
        order.status === eOrderStatus.Shipped || 
        order.status === eOrderStatus.Delivered || 
        order.status === eOrderStatus.Fulfilled">
        Shipped
      </div>
      
      <div class="step" [class.active]="
        order.status === eOrderStatus.Delivered || 
        order.status === eOrderStatus.Fulfilled">
        Delivered
      </div>
    </div>
  </div>

  <div class="details-grid">
    
    <div class="card items-card">
      <h3>Items in Order</h3>
      
      <div class="item-row" *ngFor="let item of order.productDetails">
        <img [src]="item.imageUrl" alt="{{ item.name }}" class="thumb">
        
        <div class="info">
          <p class="name">{{ item.name }}</p>
          <p class="qty">Quantity: {{ item.quantity }}</p>
          <p class="price">{{ item.priceAtPurchase | currency:'INR' }}</p>
        </div>
      </div>

      <div class="total-row">
        <span>Total Amount</span>
        <span class="big-price">{{ order.totalAmount | currency:'INR' }}</span>
      </div>
    </div>

    <div class="sidebar">
      
      <div class="card info-card">
        <h3>Shipping Details</h3>
        <p class="label">Delivery Address</p>
        <p class="value">789 Road, City, India</p>
        
        <p class="label">Payment Method</p>
        <p class="value">UPI (alice@upi)</p>
        
        <p class="label">Order Date</p>
        <p class="value">{{ order.date | date:'medium' }}</p>
      </div>

      <div class="card actions-card">
        <h3>Actions</h3>
        
        <div *ngIf="order.status === eOrderStatus.Pending || order.status === eOrderStatus.Shipped">
          
          <button *ngIf="!showCancelParams" (click)="initiateCancel()" class="btn-danger">
            Cancel Order
          </button>

          <div *ngIf="showCancelParams" class="msg-box error-box">
            <p>Please tell us why you are cancelling:</p>
            <textarea [(ngModel)]="actionReason" placeholder="e.g. Found a better price..."></textarea>
            
            <div class="msg-actions">
              <button (click)="submitCancel()" class="btn-confirm-danger">Confirm</button>
              <button (click)="closeActionBox()" class="btn-ghost">Back</button>
            </div>
          </div>
        </div>

        <div *ngIf="order.status === eOrderStatus.Delivered">
          
          <button *ngIf="!showReturnParams" (click)="initiateReturn()" class="btn-warning">
            Return Items
          </button>

          <div *ngIf="showReturnParams" class="msg-box warning-box">
            <p>Return Request. What is the issue?</p>
            <textarea [(ngModel)]="actionReason" placeholder="e.g. Product damaged..."></textarea>
            
            <div class="msg-actions">
              <button (click)="submitReturn()" class="btn-confirm-warning">Submit</button>
              <button (click)="closeActionBox()" class="btn-ghost">Back</button>
            </div>
          </div>
        </div>

        <div *ngIf="order.status === eOrderStatus.Cancelled" class="status-msg error">
          <p>⛔ This order was cancelled.</p>
        </div>
        
        <div *ngIf="order.status === eOrderStatus.Returned" class="status-msg warning">
          <p>↩ Return request processed.</p>
        </div>

        <div *ngIf="order.status === eOrderStatus.Fulfilled" class="status-msg success">
          <p>✔ Order Fulfilled</p>
          <small>Return window closed.</small>
        </div>

      </div>

    </div>
  </div>

</div>

<ng-template #notFound>
  <div class="not-found">
    <h2>Order Not Found</h2>
    <button (click)="goBack()" class="back-btn">Go Back</button>
  </div>
</ng-template>